---
title: "Manski Bounds and Causal Machine Learning"
author: "Rafael Felipe Bressan"
date: "`r Sys.Date()`"
output: 
  prettydoc::html_pretty:
    toc: true
    theme: cayman
    highlight: github
    css: "style.css"
bibliography: "references.bib"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r inst, message=FALSE}
library(data.table)
library(fixest)
library(kableExtra)
library(modelsummary)
library(MatchIt)
library(ggplot2)
```

# Manski Bounds 

_(a) State the MTR and MTS assumptions - **in the most plausible direction** - in this context. Does economic theory have any predictions on the validity of these assumptions?_

Both MTR and MTS definitions are made in @Manski2000 , they respectively are:

_MTR: Let $T$ be an ordered set. For each $j \in J$,_

$w_2\geq w_1\implies y_j(w_2)\geq y_j(w_1).$

_MTS: Let $T$ be an ordered set. For each $w \in W$,_

$u_2\geq u_1\implies E[y(w)|z=u_2]\geq E[y(w)|z=u_1].$

where $W$ denotes the treatment status, $y_j$ is the potential outcome for person $j \in J$.

In this context, the MTR assumption is most plausible when the number of children in the family **reduces** years of education of the first born child. That is:


\begin{equation}
  \text{MTR: }w_2\geq w_1\implies y_j(w_2)\leq y_j(w_1)
\end{equation}

considering that $w_i$ is the number of children in the family and the outcome $y_j$ is years of education of the first born.

In a similar way, the MTS assumption in this context will state that potential outcomes for first born children in bigger families are **lower** than the ones in smaller families.


\begin{equation}
  \text{MTS: }w_2\geq w_1\implies E[y(w)|W=w_2]\leq E[y(w)|W=w_1]
\end{equation}

First we will derive some results **for binary** treatment, following the MTR and MTS specifications from equations \@ref(eq:mtr) and \@ref(eq:mts) to get an intuition of what changes from the usual MTR and MTS assumptions. When we impose the MTR assumption in \@ref(eq:mtr), we get a zero **upper bound** on ATE, while the MTS assumption yields a **lower bound** that is equal to the naive difference of means between the two groups. We see that upper and lower bound were interchanged in this new specification. Putting the two assumptions together we have that:


\begin{equation}
  E[y_j|W=\bar w_{n}]-E[y_j|W=w_{n}]\leq\text{ATE}\leq 0
\end{equation}

where the treatment $\bar w_{n}$ refers to a family with **more** than $n$ children, and $w_{n}$ is a family with $n$ children or less, such that $P(W=\bar w_n)=\pi$ and $P(W=w_n)=1-\pi$.

We begin with the proof that MTR assumption implies the zero upper bound.

**Proposition**: Given the MTR assumption on \@ref(eq:mtr) the upper bound -- UB -- on the average treatment effect -- ATE -- is zero.


**Proof**: Suppose the treatment is binary with two levels, $w_2\geq w_1$. The probability of being assigned to $w_2$ is $\pi$. Then the MTR assumption in \@ref(eq:mtr) implies that $y_j(w_2)\leq y_j(w_1)$, and we have the following two inequalities,

$E[y_j(w_2)|w_1]\leq E[y_j|w_1]$ and $E[y_j|w_2]\leq E[y_j(w_1)|w_2]$

The ATE has the following observational-counterfactual decomposition,

$E[y_j(w_2)-y_j(w1)]=\pi E[y_j|w_2]-(1-\pi)E[y_j|w_1]-\pi E[y_j(w_1)|w_2]+(1-\pi)E[y_j(w_2)|w_1]$
  
Making use of the inequalities in the observational-counterfactual decomposition to obtain an upper bound for the ATE we have that:
  
  \begin{align*}
    \text{ATE}=E[y_j(w_2)-y_j(w1)]&\leq\pi E[y_j|w_2]-(1-\pi)E[y_j|w_1]-\pi E[y_j|w_2]+(1-\pi)E[y_j|w_1]\\
    &=0
  \end{align*}


Now we prove that the MTS assumption implies a lower bound on the ATE equal to $E[y_j|w_2]-E[y_j|w_1]$.


**Proposition**: Given the MTS assumption on \@ref(eq:mts) the lower bound -- LB -- on the average treatment effect is equal to the difference of means between the treatment groups, $\text{ATE}\geq E[y_j|w_2]-E[y_j|w_1]$.


**Proof**: Suppose once again the treatment is binary with two levels, $w_2\geq w_1$. The probability of being assigned to $w_2$ is $\pi$. Then the MTS assumption in \@ref(eq:mts) implies that potential outcomes for treatment group at $W=w_2$ are lower than in group with $W=w_1$, and we have the two inequalities,

$E[y_j(w_1)|w_2]\leq E[y_j|w_1]$ and $E[y_j|w_2]\leq E[y_j(w_2)|w_1]$
  
by the observational-counterfactual decomposition the ATE has a lower bound given by:
  
  \begin{align*}
    \text{ATE}=E[y_j(w_2)-y_j(w1)]&\geq\pi E[y_j|w_2]-(1-\pi)E[y_j|w_1]-\pi E[y_j|w_1]+(1-\pi)E[y_j|w_2]\\
    &=E[y_j|w_2]-E[y_j|w_1]
  \end{align*}


Therefore, for a multi-level treatment we can expect the same phenomenon to occur, the upper and lower bound computations will be flipped. This in turns defines that our **upper bound** on ATE will be zero, while the lower bound can be computed by eq. 9.19 from @Manski2009.

\begin{equation}
\Delta(s,t)\leq \sum_{t^\prime>t}E(y|w=t^\prime)P(w=t^\prime)+E(y|w=t)P(w\leq t)-\sum_{s^\prime < s}E(y|w=s^\prime)P(w=s^\prime)-E(y|w=s)P(w\geq s)
(\#eq:lower-bound)
\end{equation}

# References